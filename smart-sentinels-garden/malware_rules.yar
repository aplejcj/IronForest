rule Suspicious_Imports_And_Strings
{
    meta:
        description = "Detects files with a combination of suspicious imports and strings"
        author = "Smart Sentinels Garden"
        
    strings:
        // Process Injection
        $proc1 = "CreateRemoteThread"
        $proc2 = "WriteProcessMemory"
        
        // Network Activity
        $net1 = "HttpSendRequest"
        $net2 = "InternetOpen"
        
        // Keystroke Logging
        $key1 = "SetWindowsHookExA"
        $key2 = "GetAsyncKeyState"

    condition:
        // หากเจออย่างน้อย 1 คู่ในแต่ละหมวดหมู่ ให้ถือว่าอันตราย
        (1 of ($proc*)) and (1 of ($net*)) or
        (uint16(0) == 0x5A4D and 2 of ($key*)) // uint16(0)==0x5A4D คือการเช็คว่าเป็นไฟล์ PE
}

rule Packed_UPX 
{
    strings:
        $upx0 = "UPX0"
        $upx1 = "UPX1"
        $upx2 = "UPX!"
        
    condition:
        // หากเจออย่างใดอย่างหนึ่ง ให้ถือว่าเป็นไฟล์ที่ถูกบีบอัดด้วย UPX
        any of them at 0..1024
}